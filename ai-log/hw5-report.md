# HW5 Report

## What changed from HW4 and why?

For HW 4, the following architecture was employed:
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Frontend      │    │     Backend      │    │   Database      │
│   (Nginx)       │    │    (Flask)       │    │  (PostgreSQL)   │
│   Port 8080     │◄──►│   Port 8000      │◄──►│   Port 5432     │
└─────────────────┘    └──────────────────┘    └─────────────────┘
```

For HW 5, the same architecture was kept for local single host development. But, I have added in a multi-node production-like architecture:
```
┌──────────────────────────────────────────────────────────────┐
│                     Docker Swarm Cluster                     │
├──────────────────────────────┬───────────────────────────────┤
│     Manager Node             │      Worker Node              │
│   (192.168.56.10)            │    (192.168.56.11)            │
│                              │                               │
│  ┌────────────┐              │   ┌─────────────────┐        │
│  │  Frontend  │              │   │    Database     │        │
│  │  (Nginx)   │              │   │  (PostgreSQL)   │        │
│  │  1 replica │              │   │   1 replica     │        │
│  └────────────┘              │   └─────────────────┘        │
│       ▲                      │          ▲                    │
│       │                      │          │                    │
│  ┌────┴───────┐              │          │                    │
│  │    API     │              │          │                    │
│  │ (FastAPI)  │◄─────────────┼──────────┘                    │
│  │ 2 replicas │   Overlay    │   /var/lib/postgres-data     │
│  └────────────┘   Network    │   (Persistent Storage)        │
└──────────────────────────────┴───────────────────────────────┘
```

Specifically, I have decided to initialise 2 virtual machines (manager and worker) for the multi node service. Although, I understand that the assignment requires the web and api to be on my laptop, but Docker Desktop seems to have some constraint which prevents the worker from joining the swarm. I have tried this implementation in a [branch](https://github.com/TY1Fan/Name-Manager/tree/001-swarm-orchestration).

For more details (generated by Claude Sonnet 4.5):
Docker Desktop on Mac runs in a VM with network isolation, which causes several problems:

1. Docker Desktop VM isolation: The Docker engine runs inside a hidden VM, not directly on macOS
1. Port exposure: Swarm ports (2377, 7946, 4789) aren't automatically exposed from the Docker Desktop VM to your Mac's network
1. IP address confusion: docker swarm init might show an IP that's internal to Docker Desktop's VM, not accessible from external nodes

Thus, I have decided to use Vagrant to initialise a manager VM which runs web and api, hence simulating running web and api on my laptop, as well as a worker VM which runs the database. 

The implementation also uses overlay network and there is also 4 replicas in total (2 api, 1 web, 1 db) to demonstrate ingress load-balancing.

To conclude, a single node 3-tier web application where all components (web, api, and database) run on the same machine (HW 4), creates a single point of failure and limits scalability because you can only scale the entire server, not individual components. As the application grows, it can become a performance bottleneck and is more vulnerable to security threats. Thus, we enhanced our 3-tier webapp to a distributed system orchestrated by Docker Swarm so as to improve the performance, reliability and scalability of the application.

## Appendix:

Architecture with 2 VMs:
```
┌─────────────────────────────────────┐
│         Your Mac (Host)             │
│                                     │
│  ┌─────────────────────────────┐   │
│  │   Docker Desktop (Dev)      │   │
│  │   - docker-compose up       │   │
│  │   - Local development       │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  Vagrant VM 1 (Manager)     │   │
│  │  IP: 192.168.56.10          │   │
│  │  - Web service (replicas)   │   │
│  │  - API service (replicas)   │   │
│  │  Port 80 → Host 8080        │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  Vagrant VM 2 (Worker)      │   │
│  │  IP: 192.168.56.11          │   │
│  │  - DB service               │   │
│  │  - /var/lib/postgres-data   │   │
│  └─────────────────────────────┘   │
└─────────────────────────────────────┘